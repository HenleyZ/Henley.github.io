<!DOCTYPE html>
<html lang="en">
<head>
    <div class="main">
        <div class="newhome" id="artnewhome" style="background-image: linear-gradient( rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5) ), url(/images/arcadiamap.png)">
        <h1>Arcadia</h1>

        </div> 
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Henley Zhang</title>
    <link rel="icon" type="image/webp" href="images/lepuff.webp">
    <link rel="stylesheet" href="styles.css">   
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
</head>
<body>
<div id="main"></div>
<!-- NAVBAR -->
<nav class="navbar">
    <div class="navbar__container">
    <a href="/" id="navbar__logo"><img src="images/jig.png" id="jig" alt="jig">Henley</a>
    <div class="navbar__toggle" id="mobile-menu">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
    </div>
    <ul class="navbar__menu">
        <li class="navbar__item">
            <a href="/index.html#main" class="navbar__links">home</a>
        </li>
        <li class="navbar__item">
            <a href="/index.html#Projects" class="navbar__links">
             projects   
            </a>
        </li>
    
        <li class="navbar__item">
            <a href="/arts.html" class="navbar__links">
             arts   
            </a>
        </li>
        <li class="navbar__item">
            <a href="/index.html#Fun" class="navbar__links">
             fun
            </a>
        </li>    
    </ul>
</div>
</nav>
<!-- HERO -->
<div class="main">
    <div class="main__container">
        <div class="main__content">
            <h2>Features</h2>
            
            <h2>Table of Contents</h2>
            <ul>
                <li><a href="#server-authoritative-networking">Server Authoritative Networking System</a></li>
                <li><a href="#lag-compensation">Custom Lag Compensation Algorithm</a></li>
                <li><a href="#gunplay-recoil">Gunplay Recoil Algorithm</a></li>
                <li><a href="#bullet-hitscan">Bullet Hitscan Penetration Algorithm</a></li>
                <li><a href="#game-framework">Game Framework + Design</a></li>
            </ul>
        
            <h1 id="server-authoritative-networking">Server Authoritative Networking System</h1>
            <p>The game is networked using a server authoritative system rather than a P2P client-based system. The advantages are that it is much more secure since the client has no authority to change what happens on the server; it only sends requests that the server acts on, preventing many abuses caused by a modified client. However, this style of networking presents many challenges. The client side has to be programmed to preserve responsiveness in movement and shooting, meaning that actions initiated by the player are split into a local instance and a server instance. The server also has to account for lag compensation; otherwise, the validation of a line trace (a fired bullet) has to account for the passage of time between information being sent from the client to the server.</p>
            <img src="https://docs.elympics.cc/images/overview/sa1.png" alt="diagram" width="90%" style="padding:1rem;">
        
            <h1 id="lag-compensation">Custom Lag Compensation Algorithm</h1>
            <p>Everything seemed alright when I booted up the server on my LAN. The game felt fluid and responsive. However, as soon as I tried to connect to a server my friend hosted 1000 miles away, the networking completely fell apart. None of the bullets I fired hit the target; the bullets that seemed to miss resulted in a kill. I did a lot of research into the problem and discovered the issue of lag compensation. This video explains this topic way better than I could.</p>
            
            <iframe width="560" height="315" src="https://www.youtube.com/embed/6EwaW2iz4iA?si=DnSXCVcKIKMg-LHQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
            
            <p>However, the problem was that I was programming in Unreal Engine, and such a framework did not exist (actually, it does, but for $350!). I basically gave up on the problem until I came across this research paper <a style="color: blueviolet;" href="https://liu.diva-portal.org/smash/get/diva2:1605200/FULLTEXT01.pdf">here</a> detailing a method for developing a lag compensation algorithm along with testing methodology. I soon ended up with this system.</p>
            
            <ol>
                <li>The server saves a bone map and the location of every single player every tick. The bone map is a hashtable that maps bone names to their local transforms. This location object also maps in a hash table that maps players to their locations. A final double-ended queue maps the player hash tables to the exact server time.</li>
                <li>Each client is constantly pinging the server for the ping. (ex 20ms) This ping is updated and saved on the server.</li>
                <li>When a client fires a lag-compensated shot, it sends the details of the line trace to the server.</li>
                <li>The server uses the saved client's ping along with the current server time to determine exactly what time the client fired the shot on their local instance, which lags behind the server instance in terms of updated information.</li>
                <li>This exact time is searched for in the double-ended queue. The time is between two ticks of the server, so the server fetches those two time hashmaps.</li>
                <li>The two times hash tables are used to find the positions and transforms of the bones of the player at that time. A final calculated bone transform is determined by linearly interpolating between the two transforms.</li>
                <li>The bone transforms are used to reconstruct a hitbox object, which lives on the server.</li>
                <li>The line trace is performed in the world and checks for hits against the hitbox object. If the hit connects, the damage is applied.</li>
            </ol>
            
            <div class="artbox"></div>
        </div>
        
        </div>
    </div>
</div>




<script src="app.js"></script>
<script src="https://cdn.rawgit.com/michalsnik/aos/2.1.1/dist/aos.js"></script>
<script>
    AOS.init();
  </script>
</body>
</html>